# /etc/dovecot/conf.d/25-services.conf
# All service listeners and workers.

# doveadm remote admin
# Set doveadm_password in extra.conf.
service doveadm {
  inet_listener doveadm {
    port = 12345
  }
  vsz_limit = 2048 MB
}

# dict
service dict {
  unix_listener dict {
    mode = 0660
    user = vmail
    group = vmail
  }
}

# log
service log {
  user = dovenull
}

# config socket
service config {
  unix_listener config {
    user = root
    group = vmail
    mode = 0660
  }
}

# anvil socket
service anvil {
  unix_listener anvil {
    user = vmail
    group = vmail
    mode = 0660
  }
}

# auth sockets and inet
service auth {
  inet_listener auth-inet {
    port = 10001
  }
  unix_listener auth-master {
    mode = 0600
    user = vmail
  }
  unix_listener auth-userdb {
    mode = 0600
    user = vmail
  }
  vsz_limit = 2G
}

# managesieve login
service managesieve-login {
  inet_listener sieve {
    port = 4190
  }
  inet_listener sieve_haproxy {
    port = 14190
    haproxy = yes
  }
  service_restart_request_count = 1
  process_min_avail = 2
  vsz_limit = 1G
}

# imap login
service imap-login {
  service_restart_request_count = 1
  process_min_avail = 2
  process_limit = 10000
  vsz_limit = 1G
  user = dovenull
  inet_listener imap_haproxy {
    port = 10143
    haproxy = yes
  }
  inet_listener imaps_haproxy {
    port = 10993
    ssl = yes
    haproxy = yes
  }
}

# pop3 login
service pop3-login {
  service_restart_request_count = 1
  process_min_avail = 1
  vsz_limit = 1G
  inet_listener pop3_haproxy {
    port = 10110
    haproxy = yes
  }
  inet_listener pop3s_haproxy {
    port = 10995
    ssl = yes
    haproxy = yes
  }
}

# imap worker
service imap {
  executable = imap
  user = vmail
  vsz_limit = 1G
}

# managesieve worker
service managesieve {
  process_limit = 256
}

# lmtp
service lmtp {
  inet_listener lmtp-inet {
    port = 24
  }
  user = vmail
}

# quota warning hook
service quota-warning {
  executable = script /usr/local/bin/quota_notify.py
  user = vmail
  unix_listener quota-warning {
    user = vmail
  }
}

# stats
service stats {
  unix_listener stats-writer {
    mode = 0660
    user = vmail
  }
}